{% extends "layout.html" %}
{% block title %}Manage Admins - Charter Pool{% endblock %}
{% block content %}
<div class="admin-container">
  <h2>Manage Admins</h2>
  
  <div class="admin-section">
    <h3>Add New Admin</h3>
    <form method="POST" action="{{ url_for('admin_add_admin') }}" class="admin-form inline-form">
      <div class="form-group">
        <input type="text" name="username" placeholder="Username" required>
      </div>
      <div class="form-group">
        <input type="password" name="password" placeholder="Password" required>
        <small style="display: block; color: #666; margin-top: 5px;">
          Password must be at least 8 characters with uppercase, lowercase, number, and special character
        </small>
      </div>
      <button type="submit" class="btn btn-primary">Add Admin</button>
    </form>
  </div>
  
  <div class="admin-section">
    <h3>Current Admins ({{ admins|length }})</h3>
    <table class="admin-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Username</th>
          <th>Created</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for admin in admins %}
        <tr>
          <td>{{ admin.id }}</td>
          <td>
            {{ admin.username }}
            {% if admin.username == 'admin' %}
            <span style="color: #666; font-size: 0.9em;">(protected)</span>
            {% endif %}
          </td>
          <td>{{ admin.created_at.strftime('%Y-%m-%d') }}</td>
          <td class="actions-cell">
            <button type="button" class="btn btn-sm btn-secondary" onclick="showPasswordForm({{ admin.id }}, '{{ admin.username }}')">
              Change Password
            </button>
            {% if admin.username != 'admin' and admin.id != current_admin.id %}
            <form method="POST" action="{{ url_for('admin_delete_admin', admin_id=admin.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete admin {{ admin.username }}?');">
              <button type="submit" class="btn btn-sm btn-danger">Delete</button>
            </form>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<div id="passwordModal" class="modal" style="display:none;">
  <div class="modal-content">
    <h3>Change Password for <span id="modalUsername"></span></h3>
    <form id="passwordForm" method="POST" action="">
      <div class="form-group">
        <label for="new_password">New Password</label>
        <input type="password" id="new_password" name="new_password" required>
        <small style="display: block; color: #666; margin-top: 5px;">
          Password must be at least 8 characters with uppercase, lowercase, number, and special character
        </small>
      </div>
      <button type="submit" class="btn btn-primary">Change Password</button>
      <button type="button" class="btn btn-secondary" onclick="hidePasswordForm()">Cancel</button>
    </form>
  </div>
</div>

<script>
function showPasswordForm(adminId, username) {
  document.getElementById('modalUsername').textContent = username;
  document.getElementById('passwordForm').action = '/admin/admins/' + adminId + '/change_password';
  document.getElementById('passwordModal').style.display = 'flex';
}

function hidePasswordForm() {
  document.getElementById('passwordModal').style.display = 'none';
  document.getElementById('new_password').value = '';
}
</script>
{% endblock %}

